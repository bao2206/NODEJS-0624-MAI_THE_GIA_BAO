<% const collection="product"; const linkPrefix=''; const linkThumb=''; %> <%
const isEditing = product && product._id; %>
<div class="card card-info card-outline">
  <form
    action="/admin/product/form"
    method="POST"
    enctype="multipart/form-data"
    class="mb-0"
  >
    <input type="hidden" name="id" value="<%= product ? product._id : '' %>" />
    <div class="card-body">
      <h1><%= isEditing ? 'Edit' : 'Add' %> - Product Form</h1>

      <% if (errors && errors.length > 0) { %>
      <div class="alert alert-danger">
        <ul>
          <% errors.forEach(error => { %>
          <li><%= error.msg %></li>
          <% }); %>
        </ul>
      </div>
      <% } %>

      <div class="form-group row">
        <label for="name" class="col-sm-2 col-form-label text-sm-right required"
          >Name</label
        >
        <div class="col-xs-12 col-sm-8">
          <input
            type="text"
            id="name-input-form"
            name="name"
            class="form-control form-control-sm"
            value="<%= product ? product.name : '' %>"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="price"
          class="col-sm-2 col-form-label text-sm-right required"
          >Price</label
        >
        <div class="col-xs-12 col-sm-8">
          <input
            type="number"
            id="price-input-form"
            name="price"
            class="form-control form-control-sm"
            value="<%= product ? product.price : '' %>"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="quantity"
          class="col-sm-2 col-form-label text-sm-right required"
          >Quantity</label
        >
        <div class="col-xs-12 col-sm-8">
          <input
            type="number"
            id="quantity-input-form"
            name="quantity"
            class="form-control form-control-sm"
            value="<%= product ? product.quantity : '' %>"
          />
        </div>
      </div>

      <div class="form-group row">
        <label for="discount" class="col-sm-2 col-form-label text-sm-right"
          >Discount (%)</label
        >
        <div class="col-xs-12 col-sm-8">
          <input
            type="number"
            id="discount-input-form"
            name="discount"
            class="form-control form-control-sm"
            value="<%= product ? product.discount : '' %>"
          />
        </div>
      </div>

      <div class="form-group row">
        <label for="isSpecial" class="col-sm-2 col-form-label text-sm-right"
          >Special</label
        >
        <div class="col-xs-12 col-sm-8">
          <input type="checkbox" id="isSpecial" name="isSpecial" value="true"
          <%= product && product.isSpecial ? 'checked' : '' %> />
        </div>
      </div>

      <div class="form-group row">
        <label for="image" class="col-sm-2 col-form-label text-sm-right"
          >Image</label
        >
        <div class="col-xs-12 col-sm-8">
          <input
            type="file"
            name="image"
            class="form-control form-control-sm"
            id="image-input"
          />
          <% if (product && product.image) { %>
          <div>
            <img
              src="<%= product.image %>"
              alt="Product Image"
              style="max-width: 100px; max-height: 100px"
            />
            <button
              type="button"
              class="btn btn-sm btn-danger"
              id="delete-image-btn"
            >
              Delete Image
            </button>
          </div>
          <% } else { %>
          <div id="image-preview"></div>
          <% } %>
        </div>
      </div>

      <div class="form-group row">
        <label
          for="short_description"
          class="col-sm-2 col-form-label text-sm-right"
          >Short Description</label
        >
        <div class="col-xs-12 col-sm-8">
          <textarea
            id="short_description"
            name="short_description"
            class="form-control form-control-sm"
          >
<%= product ? product.short_description : '' %></textarea
          >
        </div>
      </div>

      <div class="form-group row">
        <label
          for="details_product"
          class="col-sm-2 col-form-label text-sm-right"
          >Details</label
        >
        <div class="col-xs-12 col-sm-8">
          <textarea
            id="details_product"
            name="details_product"
            class="form-control form-control-sm"
          >
<%= product ? product.details_product : '' %></textarea
          >
        </div>
      </div>
    </div>
    <div class="card-footer">
      <div class="col-12 col-sm-8 offset-sm-2">
        <button type="submit" class="btn btn-sm btn-success mr-1">
          <%= isEditing ? "Update" : "Add" %>
        </button>
        <a href="/admin/product" class="btn btn-sm btn-danger mr-1">Cancel</a>
      </div>
    </div>
  </form>
</div>

<script>
  document
    .getElementById("image-input")
    .addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const preview = document.getElementById("image-preview");
          preview.innerHTML =
            '<img src="' +
            e.target.result +
            '" alt="Image Preview" style="max-width: 100px; max-height: 100px;" />';
        };
        reader.readAsDataURL(file);
      }
    });

  document
    .getElementById("delete-image-btn")
    .addEventListener("click", function () {
      document.getElementById("image-input").value = "";
      document.getElementById("image-preview").innerHTML = "";
    });
</script>
